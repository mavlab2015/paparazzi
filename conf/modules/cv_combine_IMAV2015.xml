<!DOCTYPE module SYSTEM "module.dtd">

<module name="cv_combine_IMAV2015" dir="computer_vision">
  <doc>
    <description>
        Hovers the drone based on optical flow made for Linux video Devices.

        Computes Pitch- and roll attide from downward looking camera looking at a textured floor.
        - Sonar is required.
        - Controller can hold position
    </description>

    <!-- Satbilization parameters and gains -->
    <section name="VISION" prefix="VISION_">
      <define name="PHI_PGAIN" value="375" description="Optic flow proportional gain on the roll velocity error"/>
      <define name="PHI_IGAIN" value="30" description="Optic flow integrated gain on the summed roll velocity error"/>
      <define name="PHI_DGAIN" value="0" description="Optic flow differential gain on the summed roll velocity error"/>
      <define name="THETA_PGAIN" value="375" description="Optic flow proportional gain on the pitch velocity error"/>
      <define name="THETA_IGAIN" value="30" description="Optic flow integrated gain on the summed pitch velocity error"/>
      <define name="THETA_DGAIN" value="0" description="Optic flow differential gain on the summed pitch velocity error"/>
      <define name="DESIRED_VX" value="0" description="The desired velocity in the body frame x direction"/>
      <define name="DESIRED_VY" value="0" description="The desired velocity in the body frame y direction"/>
    </section>
    
    <section name="VISIONHOVER" prefix="VH_">
      <define name="PHI_PGAIN" value="300" description="Vision hover proportional gain on the roll velocity error"/>
      <define name="PHI_IGAIN" value="0" description="Vision hover integrated gain on the summed roll velocity error"/>
      <define name="PHI_DGAIN" value="0" description="Vision hover differential gain on the roll velocity error"/>
      <define name="THETA_PGAIN" value="300" description="Vision hover proportional gain on the pitch velocity error"/>
      <define name="THETA_IGAIN" value="0" description="Vision hover integrated gain on the summed pitch velocity error"/>
      <define name="THETA_DGAIN" value="0" description="Vision hover differential gain on the pitch velocity error"/>
      <define name="ALPHA" value="1" description="Low-pass filter coefficient"/>
      <define name="LANDING_MARKER" value="FALSE" description="LANDING ON MARKER ENABLED"/>
      <define name="DROP" value="FALSE" description="DROPPING AN OBJECT"/>
      <define name="HEAT_ENTER" value="0" description="HEATING A RESISTOR WHEN STARTING THE MODULE AP"/>
      <define name="DESCENT_RATE" value="0.1" description="DESCENT_RATE"/>
      <define name="ALT_SECOND" value="-600" description="Flight altitude (not hovering)"/>
      <define name="FACTOR_ALT" value="1.2" description="Flight altitude factor (for dropping hovering)"/>
      <define name="LANDING_COUNT_A" value="1000" description="Landing count A"/>
      <define name="LANDING_COUNT_B" value="6000" description="Landing count B"/>
      <define name="LANDING_COUNT_C" value="4000" description="Landing count C"/>
      <define name="LANDING_COUNT_D" value="4000" description="Landing count D"/>

      
      <define name="NO_MARKER_COUNT" value="120" description="Count when there is no marker detected = Threshold forever_hover"/>
      <define name="VEL_SAT" value="15" description="OF Velocity Saturation value"/>     
      <define name="ERR" value="10" description="Marker deviation tolerance value [pix]"/>    

      <define name="M" value="8" description="The distance between the pixel of interest and farthest neighbor pixel [pixel]"/>
      <define name="m" value="3" description="The safety margin around the pixel of interest [pixel]"/>
      <define name="t" value="5" description="Threshold for intensity difference"/>
      <define name="RADIUS" value="10" description="Radius used for inlier detection"/>
      <define name="IN" value="3" description="The number of minimum inliers required"/>
     
      <define name="LINE_FOLLOW" value="FALSE" description="FOLLOWING A LINE"/>
      <define name="LINE_PHI_PGAIN" value="400" description="Line following proportional gain on the roll velocity error"/>
      <define name="LINE_THETA_PGAIN" value="400" description="Line following proportional gain on the pitch velocity error"/>
      <define name="LINE_VEL_X_SAT" value="40" description="Line following OF Velocity Saturation value"/>
      <define name="LINE_VEL_Y_SAT" value="20" description="Line following OF Velocity Saturation value"/>
      <define name="LINE_CMD_SAT" value="300" description="OF euler angle command saturation value"/>   
      <define name="LINE_ALT_SECOND" value="-400" description="Flight altitude (not hovering)"/>
      <define name="LINE_NO_COUNT" value="100" description="COUNT WHEN ROPE IS NOT VISIBLE"/>  
      <define name="LINE_W" value="5" description="LINE WIDTH ESTIMATION"/>
      <define name="LINE_THR" value="100" description="ROPE INTENSITY THRESHOLD"/>  
      
      <define name="FLOWER_MODE" value="FALSE" description="FLOWER MODE ENABLED"/>
      <define name="FLOWER_NO_MARKER_COUNT" value="30" description="FLOWER NO MARKER COUNT"/>
      <define name="RIGHT_FORWARD_VX" value="0.7" description="RIGHT FORWARD VX"/>
      <define name="RIGHT_FORWARD_VY" value="0.7" description="RIGHT FORWARD VY"/>
      <define name="LEFT_FORWARD_VX" value="-0.7" description="LEFT FORWARD VX"/>
      <define name="LEFT_FORWARD_VY" value="0.7" description="LEFT FORWARD VX"/>
    </section>

    <!-- Optical flow calculation parameters -->
    <section name="OPTICFLOW" prefix="OPTICFLOW_">
      <define name="AGL_ID" value="ABI_SENDER_ID" description="ABI sender id for AGL message (sonar measurement) (default: ABI_BROADCAST)"/>

      <!-- Video device parameters -->
      <define name="DEVICE" value="/dev/video2" description="The V4L2 camera device that is used for the calculations"/>
      <define name="DEVICE_SIZE" value="320,240" description="The V4L2 camera device width and height"/>
      <define name="DEVICE_BUFFERS" value="15" description="Amount of V4L2 video buffers"/>
      <define name="SUBDEV" description="The V4L2 subdevice to initialize before the main device"/>

      <!-- Camera parameters -->
      <define name="FOV_W" value="0.89360857702" description="The field of view width of the bottom camera (Defaults are from an ARDrone 2)"/>
      <define name="FOV_H" value="0.67020643276" description="The field of view height of the bottom camera (Defaults are from an ARDrone 2)"/>
      <define name="FX" value="343.1211" description="Field in the x direction of the camera (Defaults are from an ARDrone 2)"/>
      <define name="FY" value="348.5053" description="Field in the y direction of the camera (Defaults are from an ARDrone 2)"/>

      <!-- Lucas Kanade optical flow calculation parameters -->
      <define name="MAX_TRACK_CORNERS" value="25" description="The maximum amount of corners the Lucas Kanade algorithm is tracking between two frames"/>
      <define name="WINDOW_SIZE" value="10" description="Window size used in Lucas Kanade algorithm"/>
      <define name="SUBPIXEL_FACTOR" value="10" description="Amount of subpixels per pixel, used for more precise (subpixel) calculations of the flow"/>
      <define name="MAX_ITERATIONS" value="10" description="Maximum number of iterations the Lucas Kanade algorithm should take"/>
      <define name="THRESHOLD_VEC" value="2" description="TThreshold in subpixels when the iterations of Lucas Kanade should stop"/>

      <!-- FAST9 corner detection parameters -->
      <define name="FAST9_ADAPTIVE" value="TRUE" description="Whether we should use and adapative FAST9 crner detection threshold"/>
      <define name="FAST9_THRESHOLD" value="20" description="FAST9 default threshold"/>
      <define name="FAST9_MIN_DISTANCE" value="10" description="The amount of pixels between corners that should be detected"/>
    </section>
  </doc>

  <settings>
	  <dl_settings NAME="Vision stabilization">
      <!-- Satabilization loop parameters and gains -->
      <dl_settings name="vision_stab">
        <dl_setting var="opticflow_stab.phi_pgain" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="1000" shortname="kp_op_phi" param="VISION_PHI_PGAIN"/>
        <dl_setting var="opticflow_stab.phi_igain" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="100" shortname="ki_op_phi" param="VISION_PHI_IGAIN"/>
        <dl_setting var="opticflow_stab.phi_dgain" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="100" shortname="kd_op_phi" param="VISION_PHI_DGAIN"/>
        <dl_setting var="opticflow_stab.theta_pgain" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="1000" shortname="kp_op_theta" param="VISION_THETA_PGAIN"/>
        <dl_setting var="opticflow_stab.theta_igain" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="100" shortname="ki_op_theta" param="VISION_THETA_IGAIN"/>
        <dl_setting var="opticflow_stab.theta_dgain" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="100" shortname="kd_op_theta" param="VISION_THETA_DGAIN"/>
        <dl_setting var="opticflow_stab.desired_vx" module="computer_vision/IMAV2015_combine_module" min="-5" step="0.1" max="5" shortname="desired_vx" param="VISION_DESIRED_VX"/>
        <dl_setting var="opticflow_stab.desired_vy" module="computer_vision/IMAV2015_combine_module" min="-5" step="0.1" max="5" shortname="desired_vy" param="VISION_DESIRED_VY"/>
      </dl_settings>
      
      <dl_settings name="MARKER">
        <dl_setting var="visionhover_stab.phi_pgain" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="1000" shortname="kp_vh_phi" param="VH_PHI_PGAIN"/>
	<dl_setting var="visionhover_stab.phi_igain" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="1000" shortname="ki_vh_phi" param="VH_PHI_IGAIN"/>
	<dl_setting var="visionhover_stab.phi_dgain" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="1000" shortname="kd_vh_phi" param="VH_PHI_DGAIN"/>
	<dl_setting var="visionhover_stab.theta_pgain" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="1000" shortname="kp_vh_theta" param="VISION_THETA_PGAIN"/>
	<dl_setting var="visionhover_stab.theta_igain" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="1000" shortname="ki_vh_theta" param="VH_THETA_IGAIN"/>
	<dl_setting var="visionhover_stab.theta_dgain" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="1000" shortname="kd_vh_theta" param="VH_THETA_DGAIN"/>
	<dl_setting var="visionhover_stab.alpha" module="computer_vision/IMAV2015_combine_module" min="0" step="0.1" max="1" shortname="lowpass_alpha" param="VH_ALPHA"/>
	<dl_setting var="visionhover_stab.landing_marker" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="1" values="FALSE|TRUE" shortname="land_marker" param="VH_LANDING_MARKER"/>
	<dl_setting var="visionhover_stab.drop" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="1" values="FALSE|TRUE" shortname="drop_enabled" param="VH_DROP"/>
	<dl_setting var="visionhover_stab.heat_enter" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="4" shortname="heat_enter" param="VH_HEAT_ENTER"/>
	<dl_setting var="visionhover_stab.alt_second" module="computer_vision/IMAV2015_combine_module" min="-1000" step="1" max="-200" shortname="alt_second" param="VH_ALT_SECOND"/>
	<dl_setting var="visionhover_stab.factor_alt" module="computer_vision/IMAV2015_combine_module" min="0.5" step="0.01" max="2" shortname="factor_alt" param="VH_FACOR_ALT"/>
	<dl_setting var="visionhover_stab.landing_count_A" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="10000" shortname="COUNT_A" param="VH_LANDING_COUNT_A"/>
	<dl_setting var="visionhover_stab.landing_count_B" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="10000" shortname="COUNT_B" param="VH_LANDING_COUNT_B"/>
	<dl_setting var="visionhover_stab.landing_count_C" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="10000" shortname="COUNT_C" param="VH_LANDING_COUNT_C"/>
	<dl_setting var="visionhover_stab.landing_count_D" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="10000" shortname="COUNT_D" param="VH_LANDING_COUNT_D"/>
	<dl_setting var="visionhover_stab.no_marker_count" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="1000" shortname="no_marker_count" param="VH_NO_MARKER_COUNT"/>
	<dl_setting var="visionhover_stab.descent_rate" module="computer_vision/IMAV2015_combine_module" min="0" step="0.001" max="1" shortname="descent_rate" param="VH_DESCENT_RATE"/>
	<dl_setting var="visionhover_stab.vel_sat" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="60" shortname="vel_sat" param="VH_VEL_SAT"/>
	<dl_setting var="visionhover_stab.err" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="60" shortname="err" param="VH_ERR"/>
	
	<dl_setting var="visionhover_param.M" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="20" shortname="M" param="VH_M"/>
	<dl_setting var="visionhover_param.m" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="10" shortname="m" param="VH_m"/>
	<dl_setting var="visionhover_param.t" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="255" shortname="t" param="VH_t"/>
	<dl_setting var="visionhover_param.radius" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="255" shortname="radius" param="VH_RADIUS"/>
	<dl_setting var="visionhover_param.IN" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="30" shortname="IN" param="VH_IN"/>
      </dl_settings>

      <dl_settings name="LINE">
        <dl_setting var="visionhover_stab.line_follow" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="1" values="FALSE|TRUE" shortname="line_following" param="VH_LINE_FOLLOW"/>
	<dl_setting var="visionhover_stab.line_phi_pgain" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="1000" shortname="kp_line_phi" param="VH_LINE_PHI_PGAIN"/>
	<dl_setting var="visionhover_stab.line_theta_pgain" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="1000" shortname="kp_line_theta" param="VH_LINE_THETA_PGAIN"/>
	<dl_setting var="visionhover_stab.line_vel_x_sat" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="1000" shortname="line_vel_x_sat" param="VH_LINE_VEL_X_SAT"/>
	<dl_setting var="visionhover_stab.line_vel_y_sat" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="1000" shortname="line_vel_y_sat" param="VH_LINE_VEL_Y_SAT"/>
	<dl_setting var="visionhover_stab.line_cmd_sat" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="1500" shortname="line_cmd_sat" param="VH_LINE_CMD_SAT"/>
	<dl_setting var="visionhover_stab.line_alt_second" module="computer_vision/IMAV2015_combine_module" min="-700" step="1" max="-100" shortname="line_alt_2nd" param="VH_LINE_ALT_SECOND"/>
	<dl_setting var="visionhover_stab.line_no_count" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="1000" shortname="line_no_count" param="VH_LINE_NO_COUNT"/>
	<dl_setting var="visionhover_param.line_w" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="20" shortname="line_w" param="VH_LINE_W"/>
	<dl_setting var="visionhover_param.line_thr" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="255" shortname="line_thr" param="VH_LINE_THR"/>
      </dl_settings>
      
      <dl_settings name="FLOWER">
        <dl_setting var="visionhover_stab.flower_mode" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="1" values="FALSE|TRUE" shortname="flower_mode" param="VH_FLOWER_MODE"/>
        <dl_setting var="visionhover_stab.flower_no_marker_count" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="200" shortname="fl_no_count" param="VH_FLOWER_NO_MARKER_COUNT"/>

	    <dl_setting var="visionhover_stab.right_forward_vx" module="computer_vision/IMAV2015_combine_module" min="-2" step="0.1" max="2" shortname="right_vy" param="VH_RIGHT_FORWARD_VX"/>
	    <dl_setting var="visionhover_stab.right_forward_vy" module="computer_vision/IMAV2015_combine_module" min="-2" step="0.1" max="2" shortname="right_vy" param="VH_RIGHT_FORWARD_VY"/>
	    <dl_setting var="visionhover_stab.left_forward_vx" module="computer_vision/IMAV2015_combine_module" min="-2" step="0.1" max="2" shortname="left_vx" param="VH_LEFT_FORWARD_VX"/>
	    <dl_setting var="visionhover_stab.left_forward_vy" module="computer_vision/IMAV2015_combine_module" min="-2" step="0.1" max="2" shortname="left_vy" param="VH_LEFT_FORWARD_VY"/>
	    <dl_setting var="visionhover_stab.servo_count" module="computer_vision/IMAV2015_combine_module" min="1" step="1" max="1000" shortname="servo_cnt" param="VH_SERVO_COUNT"/>
	    
	    <dl_setting var="flowerdetect_param.red_y_m" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="255" shortname="red y_m" param="FD_red_y_m"/>
	    <dl_setting var="flowerdetect_param.red_y_M" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="255" shortname="red y_M" param="FD_red_y_M"/>
	    <dl_setting var="flowerdetect_param.red_u_m" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="255" shortname="red u_m" param="FD_red_u_m"/>
	    <dl_setting var="flowerdetect_param.red_u_M" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="255" shortname="red u_M" param="FD_red_u_M"/>
	    <dl_setting var="flowerdetect_param.red_v_m" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="255" shortname="red v_m" param="FD_red_v_m"/>
	    <dl_setting var="flowerdetect_param.red_v_M" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="255" shortname="red v_M" param="FD_red_v_M"/>
	    
	    <dl_setting var="flowerdetect_param.green_y_m" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="255" shortname="green y_m" param="FD_green_y_m"/>
	    <dl_setting var="flowerdetect_param.green_y_M" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="255" shortname="green y_M" param="FD_green_y_M"/>
	    <dl_setting var="flowerdetect_param.green_u_m" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="255" shortname="green u_m" param="FD_green_u_m"/>
	    <dl_setting var="flowerdetect_param.green_u_M" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="255" shortname="green u_M" param="FD_green_u_M"/>
	    <dl_setting var="flowerdetect_param.green_v_m" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="255" shortname="green v_m" param="FD_green_v_m"/>
	    <dl_setting var="flowerdetect_param.green_v_M" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="255" shortname="green v_M" param="FD_green_v_M"/>
	    
	    <dl_setting var="flowerdetect_param.blue_y_m" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="255" shortname="blue y_m" param="FD_blue_y_m"/>
	    <dl_setting var="flowerdetect_param.blue_y_M" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="255" shortname="blue y_M" param="FD_blue_y_M"/>
	    <dl_setting var="flowerdetect_param.blue_u_m" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="255" shortname="blue u_m" param="FD_blue_u_m"/>
	    <dl_setting var="flowerdetect_param.blue_u_M" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="255" shortname="blue u_M" param="FD_blue_u_M"/>
	    <dl_setting var="flowerdetect_param.blue_v_m" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="255" shortname="blue v_m" param="FD_blue_v_m"/>
	    <dl_setting var="flowerdetect_param.blue_v_M" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="255" shortname="blue v_M" param="FD_blue_v_M"/>

      </dl_settings>

      <!-- Optical flow calculations parameters for Lucas Kanade and FAST9 -->
      <dl_settings name="vision_calc">
        <dl_setting var="opticflow.max_track_corners" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="500" shortname="max_trck_corners" param="OPTICFLOW_MAX_TRACK_CORNERS"/>
        <dl_setting var="opticflow.window_size" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="500" shortname="window_size" param="OPTICFLOW_WINDOW_SIZE"/>
        <dl_setting var="opticflow.subpixel_factor" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="100" shortname="subpixel_factor" param="OPTICFLOW_SUBPIXEL_FACTOR"/>
        <dl_setting var="opticflow.max_iterations" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="100" shortname="max_iterations" param="OPTICFLOW_MAX_ITERATIONS"/>
        <dl_setting var="opticflow.threshold_vec" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="100" shortname="threshold_vec" param="OPTICFLOW_THRESHOLD_VEC"/>

        <dl_setting var="opticflow.fast9_adaptive" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="1" values="TRUE|FALSE" shortname="fast9_adaptive" param="OPTICFLOW_FAST9_ADAPTIVE"/>
        <dl_setting var="opticflow.fast9_threshold" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="255" shortname="fast9_threshold" param="OPTICFLOW_FAST9_THRESHOLD"/>
        <dl_setting var="opticflow.fast9_min_distance" module="computer_vision/IMAV2015_combine_module" min="0" step="1" max="500" shortname="fast9_min_distance" param="OPTICFLOW_FAST9_MIN_DISTANCE"/>
      </dl_settings>
    </dl_settings>
  </settings>

  <header>
    <file name="IMAV2015_combine_module.h"/>
  </header>

  <init fun="opticflow_module_init()"/>
  <periodic fun="opticflow_module_run()" start="opticflow_module_start()" stop="opticflow_module_stop()" autorun="TRUE"/>

  <makefile target="ap">
    <!-- Include the needed Computer Vision files -->
    <define name="modules/computer_vision" type="include"/>
    <file name="image.c" dir="modules/computer_vision/lib/vision"/>
    <file name="jpeg.c" dir="modules/computer_vision/lib/encoding"/>
    <file name="rtp.c" dir="modules/computer_vision/lib/encoding"/>
    <file name="v4l2.c" dir="modules/computer_vision/lib/v4l"/>

    <!-- The optical flow module (calculator+stabilization) -->
    <file name="IMAV2015_combine_module.c"/>
    <file name="opticflow_calculator_IMAV2015.c" dir="modules/computer_vision/combine"/>
    <file name="stabilization_opticflow_IMAV2015.c" dir="modules/computer_vision/combine"/>

    <!-- Main vision calculations -->
    <file name="fast_rosten.c" dir="modules/computer_vision/lib/vision"/>
    <file name="lucas_kanade.c" dir="modules/computer_vision/lib/vision"/>

    <raw>
      VIEWVIDEO_HOST        ?= $(MODEM_HOST)
      VIEWVIDEO_PORT_OUT    ?= 5000
      VIEWVIDEO_BROADCAST   ?= $(MODEM_BROADCAST)

      VIEWVID_CFLAGS  = -DVIEWVIDEO_HOST=$(VIEWVIDEO_HOST) -DVIEWVIDEO_PORT_OUT=$(VIEWVIDEO_PORT_OUT)
      ifeq ($(VIEWVIDEO_USE_NC),)
        ap.CFLAGS += $(VIEWVID_CFLAGS) -DVIEWVIDEO_BROADCAST=$(VIEWVIDEO_BROADCAST)
      else
        ap.CFLAGS += $(VIEWVID_CFLAGS) -DVIEWVIDEO_USE_NC
      endif

      ap.CFLAGS += -DGUIDANCE_V_MODE_MODULE_SETTING=GUIDANCE_V_MODE_MODULE
      ap.CFLAGS += -DGUIDANCE_H_MODE_MODULE_SETTING=GUIDANCE_H_MODE_MODULE
    </raw>
  </makefile>

  <makefile target="nps">
    <file name="viewvideo_nps.c"/>
  </makefile>

</module>

